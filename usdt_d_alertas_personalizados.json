{
  "name": "USDT.D - Alertas Personalizados",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "usdt-d-personalizado",
        "responseMode": "responseNode",
        "options": {}
      },
      "id": "webhook-usdt",
      "name": "Webhook USDT.D",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [0, 0],
      "webhookId": "usdt-d-personalizado"
    },
    {
      "parameters": {
        "jsCode": "// Receber dados do alerta\nconst body = $input.first().json.body;\n\n// Tentar parsear JSON se vier como string\nlet alertData;\ntry {\n  alertData = typeof body === 'string' ? JSON.parse(body) : body;\n} catch (e) {\n  alertData = body;\n}\n\n// Extrair informaÃ§Ãµes\nconst symbol = alertData.symbol || 'USDT.D';\nconst price = alertData.price || alertData.close || 'N/A';\nconst level = alertData.level || alertData.sr_level || 'N/A';\nconst type = alertData.type || alertData.sr_type || 'N/A'; // suporte ou resistencia\nconst distance = alertData.distance || 'N/A';\n\n// Determinar emoji e texto baseado no tipo\nlet emoji = 'ğŸ“Š';\nlet typeText = 'NÃ­vel S/R';\n\nif (type.toLowerCase().includes('suporte') || type.toLowerCase().includes('support')) {\n  emoji = 'ğŸŸ¢';\n  typeText = 'SUPORTE';\n} else if (type.toLowerCase().includes('resistencia') || type.toLowerCase().includes('resistance')) {\n  emoji = 'ğŸ”´';\n  typeText = 'RESISTÃŠNCIA';\n}\n\n// Formatar mensagem\nlet message = `ğŸ“Š <b>USDT.D - Alerta de DominÃ¢ncia</b>\\n`;\nmessage += `â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\\n`;\nmessage += `${emoji} <b>PrÃ³ximo de ${typeText}</b>\\n\\n`;\nmessage += `ğŸ’° PreÃ§o Atual: ${price}%\\n`;\nmessage += `ğŸ“ NÃ­vel S/R: ${level}%\\n`;\nif (distance !== 'N/A') message += `ğŸ“ DistÃ¢ncia: ${distance}%\\n`;\nmessage += `â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\\n`;\nmessage += `ğŸ’¡ <i>USDT.D subindo = mercado caindo</i>\\n`;\nmessage += `ğŸ’¡ <i>USDT.D caindo = mercado subindo</i>\\n`;\nmessage += `â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\\n`;\nmessage += `âš ï¸ <i>NÃ£o Ã© recomendaÃ§Ã£o de investimento</i>`;\n\nreturn {\n  message: message,\n  alertData: alertData\n};"
      },
      "id": "processar-alerta-usdt",
      "name": "Processar Alerta USDT.D",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [220, 0]
    },
    {
      "parameters": {
        "method": "GET",
        "url": "https://api.airtable.com/v0/BASE_ID/Preferencias?filterByFormula=AND({ativo}=TRUE(),{filtro_usdt_d}=TRUE())",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "options": {}
      },
      "id": "buscar-usuarios-usdt",
      "name": "Buscar UsuÃ¡rios USDT.D",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [440, 0],
      "credentials": {
        "httpHeaderAuth": {
          "id": "CONFIGURAR",
          "name": "Airtable API"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const records = $input.first().json.records || [];\nconst message = $('Processar Alerta USDT.D').first().json.message;\n\n// Filtrar usuÃ¡rios que querem receber alertas USDT.D\nconst usuariosParaEnviar = [];\n\nfor (const record of records) {\n  const user = record.fields;\n  const chat_id = user.chat_id;\n  \n  if (chat_id) {\n    usuariosParaEnviar.push({\n      chat_id: chat_id,\n      message: message\n    });\n  }\n}\n\nreturn usuariosParaEnviar;"
      },
      "id": "filtrar-usuarios-usdt",
      "name": "Filtrar UsuÃ¡rios",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [660, 0]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.telegram.org/bot8437212177:AAEsm0d-ARdcj8zDGbqdpjeaSoQgsY-Byqc/sendMessage",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"chat_id\": {{ $json.chat_id }},\n  \"text\": \"{{ $json.message }}\",\n  \"parse_mode\": \"HTML\"\n}",
        "options": {}
      },
      "id": "enviar-telegram-usdt",
      "name": "Enviar Telegram",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [880, 0]
    },
    {
      "parameters": {
        "respondWith": "text",
        "responseBody": "OK",
        "options": {}
      },
      "id": "responder-webhook-usdt",
      "name": "Responder Webhook",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1,
      "position": [1100, 0]
    }
  ],
  "connections": {
    "Webhook USDT.D": {
      "main": [
        [
          {
            "node": "Processar Alerta USDT.D",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Processar Alerta USDT.D": {
      "main": [
        [
          {
            "node": "Buscar UsuÃ¡rios USDT.D",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Buscar UsuÃ¡rios USDT.D": {
      "main": [
        [
          {
            "node": "Filtrar UsuÃ¡rios",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Filtrar UsuÃ¡rios": {
      "main": [
        [
          {
            "node": "Enviar Telegram",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Enviar Telegram": {
      "main": [
        [
          {
            "node": "Responder Webhook",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "tags": [],
  "triggerCount": 1,
  "updatedAt": "2026-01-10T16:00:00.000Z",
  "versionId": "1"
}
